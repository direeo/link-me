// Prisma schema for LinkMe
// Compatible with both local SQLite and Turso (hosted SQLite for Vercel)

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "sqlite"
    url      = env("DATABASE_URL")
}

// User model for authentication
model User {
    id            String    @id @default(cuid())
    email         String    @unique
    passwordHash  String
    name          String?
    emailVerified Boolean   @default(false)
    createdAt     DateTime  @default(now())
    updatedAt     DateTime  @updatedAt

    // Relations
    verificationTokens VerificationToken[]
    chatHistories      ChatHistory[]
}

// Email verification tokens
model VerificationToken {
    id        String   @id @default(cuid())
    token     String   @unique
    userId    String
    expiresAt DateTime
    createdAt DateTime @default(now())

    // Relations
    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@index([token])
    @@index([userId])
}

// Chat history for registered users
model ChatHistory {
    id        String   @id @default(cuid())
    userId    String
    messages  String // JSON string of chat messages
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    // Relations
    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@index([userId])
}

// Rate limiting entries
model RateLimitEntry {
    id          String   @id @default(cuid())
    key         String
    count       Int      @default(1)
    windowStart DateTime @default(now())
    blockedUntil DateTime?

    @@unique([key])
    @@index([key])
}
